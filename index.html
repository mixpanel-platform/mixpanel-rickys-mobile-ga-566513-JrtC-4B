<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/css/reset.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.css">
    <script src="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.js"></script>
  </head>
  <body class="mixpanel-platform-body">
    
    <script>
      // Run queries and display results here
      var params = {
        type: 'general',  // analysis type for the data, can be 'general', 'unique', or 'average'
        limit: 50         // maximum number of results to return
      };
      
      var tableData = {};
      var eventsQuery = MP.api.topEvents(params)
      
      
      var promises = [];
      
      eventsQuery.done(function(results){

        _.each(_.values(results.values()), function(value){
          
          /* Make topProperties query with each event */
          var propQuery = MP.api.topProperties(value);
          promises.push(propQuery);
            
        }); 
      })
      
      /* When all of the topEvents are done, let's make a properties query for each Event */
      
      Promise.all(promises).then(function(promiseArray){
        console.log(promiseArray)
        
      });
      
      
      
    </script>
  </body>
</html>
